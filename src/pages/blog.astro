---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Loader from '../components/Loader.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const sortedPosts = posts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

const categories = ['All', 'AI Trends', 'Dev Build', 'Dev Tools', 'Tech Gear'];
const allTags = ['AI', 'Development', 'Machine Learning', 'Tutorial', 'Tools', 'Google', 'OpenAI', 'ChatGPT', 'Automation'];
---

<Layout title="Blog - AI Dev Daily">
  <Loader />
  <Header />
  <main>
    <section class="blog-hero">
      <div class="hero-bg">
        <div class="gradient-orb orb-1"></div>
        <div class="gradient-orb orb-2"></div>
        <div class="grid-pattern"></div>
        <div class="floating-shapes">
          <div class="shape shape-1"></div>
          <div class="shape shape-2"></div>
        </div>
      </div>
      <div class="hero-content">
        <div class="badge" data-animate="fade-up">
          <span class="badge-dot"></span>
          AI Dev Daily Blog
        </div>
        <h1 data-animate="fade-up" data-delay="1">Latest <span>Articles & Insights</span></h1>
        <p data-animate="fade-up" data-delay="2">Discover the latest in AI, web development, and tech innovation.</p>
      </div>
    </section>

    <section class="blog-content">
      <div class="container">
        <div class="blog-layout">
          <!-- Sidebar -->
          <aside class="sidebar" data-animate="fade-left">
            <!-- Search -->
            <div class="sidebar-section search-section">
              <h3>Search</h3>
              <div class="search-box">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"/>
                  <path d="M21 21l-4.35-4.35"/>
                </svg>
                <input type="text" id="searchInput" placeholder="Search articles..." />
              </div>
            </div>

            <!-- Categories -->
            <div class="sidebar-section">
              <h3>Categories</h3>
              <ul class="category-list" id="categoryFilters">
                {categories.map((category, i) => (
                  <li>
                    <button 
                      class={`category-btn ${i === 0 ? 'active' : ''}`} 
                      data-category={category}
                    >
                      {category}
                      <span class="count">{category === 'All' ? posts.length : posts.filter(p => p.data.category === category).length}</span>
                    </button>
                  </li>
                ))}
              </ul>
            </div>

            <!-- Popular Posts -->
            <div class="sidebar-section">
              <h3>Popular Posts</h3>
              <div class="popular-posts">
                {sortedPosts.slice(0, 3).map((post) => (
                  <a href={`/blog/${post.slug}`} class="popular-post">
                    <img src={post.data.image} alt={post.data.title} />
                    <div class="popular-post-info">
                      <h4>{post.data.title}</h4>
                      <span>{post.data.readTime} read</span>
                    </div>
                  </a>
                ))}
              </div>
            </div>

            <!-- Tags -->
            <div class="sidebar-section">
              <h3>Popular Tags</h3>
              <div class="tags-cloud" id="tagFilters">
                {allTags.map((tag) => (
                  <button class="tag-btn" data-tag={tag}>{tag}</button>
                ))}
              </div>
            </div>

            <!-- Newsletter -->
            <div class="sidebar-section newsletter-box">
              <h3>Subscribe</h3>
              <p>Get the latest AI news delivered to your inbox.</p>
              <form class="sidebar-form" id="sidebarNewsletter">
                <input type="email" placeholder="Your email" required />
                <button type="submit">Subscribe</button>
              </form>
            </div>
          </aside>

          <!-- Main Content -->
          <div class="main-content">
            <!-- Featured Post -->
            {sortedPosts.find(p => p.data.featured) && (
              <article class="featured-post" data-animate="fade-up" data-category={sortedPosts.find(p => p.data.featured)?.data.category} id="featuredPost">
                <div class="featured-image">
                  <img src={sortedPosts.find(p => p.data.featured)?.data.image} alt="" />
                  <span class="featured-badge">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                      <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                    </svg>
                    Featured
                  </span>
                </div>
                <div class="featured-content">
                  <div class="post-meta">
                    <span class="category">{sortedPosts.find(p => p.data.featured)?.data.category}</span>
                    <span class="date">{sortedPosts.find(p => p.data.featured)?.data.date}</span>
                  </div>
                  <h2>{sortedPosts.find(p => p.data.featured)?.data.title}</h2>
                  <p>{sortedPosts.find(p => p.data.featured)?.data.excerpt}</p>
                  <a href={`/blog/${sortedPosts.find(p => p.data.featured)?.slug}`} class="read-more">
                    Read Article
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                  </a>
                </div>
              </article>
            )}

            <!-- Posts Grid -->
            <div class="posts-grid" id="postsGrid">
              {sortedPosts.filter(p => !p.data.featured).map((post, index) => (
                <article class="post-card" data-category={post.data.category} data-animate="card" style={`--delay: ${index * 0.1}s`}>
                  <div class="post-image">
                    <img src={post.data.image} alt={post.data.title} loading="lazy" />
                    <span class="post-category">{post.data.category}</span>
                  </div>
                  <div class="post-content">
                    <div class="post-meta">
                      <span>{post.data.date}</span>
                      <span>â€¢</span>
                      <span>{post.data.readTime} read</span>
                    </div>
                    <h3>{post.data.title}</h3>
                    <p>{post.data.excerpt}</p>
                    <a href={`/blog/${post.slug}`} class="read-more-link">
                      Read more
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                      </svg>
                    </a>
                  </div>
                </article>
              ))}
            </div>

            <!-- No Results -->
            <div class="no-results" id="noResults" style="display: none;">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
              </svg>
              <h3>No articles found</h3>
              <p>Try adjusting your filters or search terms</p>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
              <button class="page-btn prev-btn" id="prevBtn" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M15 18l-6-6 6-6"/>
                </svg>
                Previous
              </button>
              <div class="page-numbers" id="pageNumbers"></div>
              <button class="page-btn next-btn" id="nextBtn">
                Next
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  <Footer />
</ Layout>

<style>
  /* Hero */
  .blog-hero {
    position: relative;
    padding: 8rem 2rem 4rem;
    background: linear-gradient(180deg, var(--gray-50) 0%, var(--white) 100%);
    overflow: hidden;
  }

  .hero-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .gradient-orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(100px);
    animation: orbFloat 15s infinite ease-in-out;
  }

  .orb-1 {
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(108, 43, 217, 0.12) 0%, transparent 70%);
    top: -150px;
    left: -100px;
  }

  .orb-2 {
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(139, 92, 246, 0.08) 0%, transparent 70%);
    bottom: -100px;
    right: -100px;
    animation-delay: -7s;
  }

  @keyframes orbFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(30px, -30px) scale(1.1); }
  }

  .grid-pattern {
    position: absolute;
    inset: 0;
    background-image: linear-gradient(rgba(108, 43, 217, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(108, 43, 217, 0.03) 1px, transparent 1px);
    background-size: 40px 40px;
  }

  .floating-shapes {
    position: absolute;
    inset: 0;
    overflow: hidden;
  }

  .shape {
    position: absolute;
    border-radius: 50%;
    animation: float 20s infinite ease-in-out;
  }

  .shape-1 {
    width: 250px;
    height: 250px;
    background: radial-gradient(circle, rgba(108, 43, 217, 0.08) 0%, transparent 70%);
    top: 30%;
    right: 15%;
  }

  .shape-2 {
    width: 180px;
    height: 180px;
    background: radial-gradient(circle, rgba(167, 139, 250, 0.08) 0%, transparent 70%);
    bottom: 20%;
    left: 10%;
  }

  @keyframes float {
    0%, 100% { transform: translate(0, 0); }
    50% { transform: translate(20px, -20px); }
  }

  .hero-content {
    position: relative;
    z-index: 1;
    text-align: center;
    max-width: 700px;
    margin: 0 auto;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(108, 43, 217, 0.1);
    border: 1px solid rgba(108, 43, 217, 0.2);
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: 0.85rem;
    color: var(--purple-primary);
    font-weight: 500;
    margin-bottom: 1.5rem;
  }

  .badge-dot {
    width: 8px;
    height: 8px;
    background: var(--purple-primary);
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.3); }
  }

  .blog-hero h1 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: clamp(2.5rem, 5vw, 3.5rem);
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: 1rem;
  }

  .blog-hero h1 span {
    background: linear-gradient(135deg, var(--purple-primary), var(--purple-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .blog-hero p {
    color: var(--gray-600);
    font-size: 1.1rem;
  }

  /* Blog Content */
  .blog-content {
    padding: 3rem 2rem 5rem;
    background: var(--white);
  }

  .container {
    max-width: 1300px;
    margin: 0 auto;
  }

  .blog-layout {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 2.5rem;
  }

  /* Sidebar */
  .sidebar {
    position: sticky;
    top: 100px;
    height: fit-content;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .sidebar-section {
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: 16px;
    padding: 1.5rem;
  }

  .sidebar-section h3 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 1rem;
  }

  /* Search */
  .search-box {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: var(--gray-50);
    border-radius: 12px;
    border: 1px solid var(--gray-200);
    transition: all 0.3s ease;
  }

  .search-box:focus-within {
    border-color: var(--purple-primary);
    box-shadow: 0 0 0 3px rgba(108, 43, 217, 0.1);
  }

  .search-box svg {
    color: var(--gray-400);
    flex-shrink: 0;
  }

  .search-box input {
    border: none;
    background: transparent;
    outline: none;
    font-size: 0.95rem;
    color: var(--gray-800);
    width: 100%;
  }

  .search-box input::placeholder {
    color: var(--gray-400);
  }

  /* Categories */
  .category-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .category-btn {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0.75rem 1rem;
    background: transparent;
    border: none;
    border-radius: 10px;
    font-size: 0.9rem;
    color: var(--gray-600);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
  }

  .category-btn:hover {
    background: rgba(108, 43, 217, 0.08);
    color: var(--purple-primary);
  }

  .category-btn.active {
    background: var(--purple-primary);
    color: var(--white);
  }

  .category-btn .count {
    font-size: 0.75rem;
    padding: 0.2rem 0.5rem;
    background: rgba(0, 0, 0, 0.08);
    border-radius: 20px;
  }

  .category-btn.active .count {
    background: rgba(255, 255, 255, 0.2);
  }

  /* Popular Posts */
  .popular-posts {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .popular-post {
    display: flex;
    gap: 1rem;
    text-decoration: none;
    padding: 0.75rem;
    background: var(--gray-50);
    border-radius: 12px;
    transition: all 0.3s ease;
  }

  .popular-post:hover {
    background: rgba(108, 43, 217, 0.08);
  }

  .popular-post img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 8px;
    flex-shrink: 0;
  }

  .popular-post-info h4 {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--gray-800);
    margin-bottom: 0.25rem;
    line-height: 1.3;
  }

  .popular-post-info span {
    font-size: 0.75rem;
    color: var(--gray-500);
  }

  /* Tags */
  .tags-cloud {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tag-btn {
    padding: 0.4rem 0.8rem;
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-radius: 20px;
    font-size: 0.8rem;
    color: var(--gray-600);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .tag-btn:hover, .tag-btn.active {
    background: var(--purple-primary);
    border-color: var(--purple-primary);
    color: var(--white);
  }

  /* Newsletter Box */
  .newsletter-box {
    background: linear-gradient(135deg, rgba(108, 43, 217, 0.1), rgba(139, 92, 246, 0.05));
    border-color: rgba(108, 43, 217, 0.2);
  }

  .newsletter-box p {
    font-size: 0.9rem;
    color: var(--gray-600);
    margin-bottom: 1rem;
  }

  .sidebar-form {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .sidebar-form input {
    padding: 0.75rem 1rem;
    border: 1px solid var(--gray-200);
    border-radius: 10px;
    font-size: 0.9rem;
    outline: none;
    transition: all 0.3s ease;
  }

  .sidebar-form input:focus {
    border-color: var(--purple-primary);
  }

  .sidebar-form button {
    padding: 0.75rem;
    background: var(--purple-primary);
    color: var(--white);
    border: none;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .sidebar-form button:hover {
    background: var(--purple-light);
  }

  /* Main Content */
  .main-content {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  /* Featured Post */
  .featured-post {
    display: grid;
    grid-template-columns: 1.2fr 1fr;
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.4s ease;
  }

  .featured-post:hover {
    box-shadow: 0 20px 50px rgba(108, 43, 217, 0.12);
    border-color: rgba(108, 43, 217, 0.3);
  }

  .featured-image {
    position: relative;
    overflow: hidden;
  }

  .featured-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .featured-post:hover .featured-image img {
    transform: scale(1.05);
  }

  .featured-badge {
    position: absolute;
    top: 1rem;
    left: 1rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: linear-gradient(135deg, #f59e0b, #fbbf24);
    color: var(--white);
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .featured-content {
    padding: 2rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .post-meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.85rem;
    color: var(--gray-500);
    margin-bottom: 0.75rem;
  }

  .post-meta .category {
    color: var(--purple-primary);
    font-weight: 500;
  }

  .featured-content h2 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--gray-800);
    line-height: 1.3;
    margin-bottom: 1rem;
  }

  .featured-content p {
    color: var(--gray-600);
    line-height: 1.7;
    margin-bottom: 1.5rem;
  }

  .read-more {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--purple-primary);
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .read-more svg {
    transition: transform 0.3s ease;
  }

  .read-more:hover svg {
    transform: translateX(5px);
  }

  /* Posts Grid */
  .posts-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  .post-card {
    background: var(--white);
    border: 1px solid var(--gray-200);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.4s ease;
    opacity: 0;
    transform: translateY(30px);
  }

  .post-card.animate {
    opacity: 1;
    transform: translateY(0);
  }

  .post-card:hover {
    transform: translateY(-8px);
    border-color: rgba(108, 43, 217, 0.3);
    box-shadow: 0 15px 40px rgba(108, 43, 217, 0.1);
  }

  .post-card.hidden {
    display: none;
  }

  .post-image {
    position: relative;
    overflow: hidden;
  }

  .post-image img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .post-card:hover .post-image img {
    transform: scale(1.08);
  }

  .post-category {
    position: absolute;
    top: 0.75rem;
    left: 0.75rem;
    background: var(--purple-primary);
    color: var(--white);
    padding: 0.3rem 0.7rem;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 600;
  }

  .post-content {
    padding: 1.25rem;
  }

  .post-content .post-meta {
    margin-bottom: 0.5rem;
  }

  .post-content h3 {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.15rem;
    font-weight: 600;
    color: var(--gray-800);
    line-height: 1.4;
    margin-bottom: 0.5rem;
  }

  .post-content p {
    color: var(--gray-600);
    font-size: 0.9rem;
    line-height: 1.6;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .read-more-link {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    color: var(--purple-primary);
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  .read-more-link svg {
    transition: transform 0.3s ease;
  }

  .post-card:hover .read-more-link svg {
    transform: translateX(4px);
  }

  /* No Results */
  .no-results {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--gray-500);
  }

  .no-results svg {
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  .no-results h3 {
    font-size: 1.25rem;
    color: var(--gray-700);
    margin-bottom: 0.5rem;
  }

  /* Animations */
  [data-animate="fade-up"], [data-animate="fade-left"] {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s ease;
  }

  [data-animate="fade-left"] {
    transform: translateX(-30px);
  }

  [data-animate].animate {
    opacity: 1;
    transform: translate(0, 0);
  }

  @media (max-width: 1024px) {
    .blog-layout {
      grid-template-columns: 1fr;
    }
    .sidebar {
      position: static;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    .sidebar-section:first-child {
      grid-column: span 2;
    }
    .posts-grid {
      grid-template-columns: 1fr;
    }
    .featured-post {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .sidebar {
      grid-template-columns: 1fr;
    }
    .sidebar-section:first-child {
      grid-column: span 1;
    }
    .blog-hero {
      padding: 6rem 1.5rem 3rem;
    }
  }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    margin-top: 3rem;
    padding: 1.5rem 0;
    background: var(--gray-50);
    border-radius: 16px;
    flex-wrap: wrap;
  }

  .page-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1.2rem;
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--gray-700);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .page-btn:hover:not(:disabled) {
    border-color: var(--purple-primary);
    color: var(--purple-primary);
    background: rgba(108, 43, 217, 0.05);
  }

  .page-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    background: var(--gray-100);
  }

  .page-numbers {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .page-number {
    min-width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--white);
    border: 2px solid var(--gray-200);
    border-radius: 12px;
    font-size: 0.95rem;
    font-weight: 500;
    color: var(--gray-700);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .page-number:hover {
    border-color: var(--purple-primary);
    color: var(--purple-primary);
  }

  .page-number.active {
    background: var(--purple-primary);
    border-color: var(--purple-primary);
    color: var(--white);
  }

  .page-dots {
    padding: 0 0.5rem;
    color: var(--gray-400);
    font-size: 0.9rem;
  }

  /* Search Highlight */
  .post-card mark {
    background: rgba(108, 43, 217, 0.2);
    color: var(--purple-primary);
    padding: 0 2px;
    border-radius: 2px;
  }

  /* Featured Post Highlight */
  .featured-post mark {
    background: rgba(108, 43, 217, 0.25);
    color: var(--purple-primary);
    padding: 0 3px;
    border-radius: 3px;
  }
</style>

<script>
  // Animation on load
  setTimeout(() => {
    document.querySelectorAll('[data-animate]').forEach(el => el.classList.add('animate'));
  }, 100);

  // Category filter
  const categoryBtns = document.querySelectorAll('.category-btn');
  const postCards = document.querySelectorAll('.post-card');
  const tagBtns = document.querySelectorAll('.tag-btn');
  const searchInput = document.getElementById('searchInput');
  const noResults = document.getElementById('noResults');
  const pagination = document.getElementById('pagination');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const pageNumbers = document.getElementById('pageNumbers');

  let activeCategory = 'All';
  let activeTag = '';
  let searchTerm = '';
  let currentPage = 1;
  const postsPerPage = 6;
  const featuredPost = document.getElementById('featuredPost');

  function getVisiblePosts() {
    return Array.from(postCards).filter(card => !card.classList.contains('hidden'));
  }

  function updatePagination() {
    const visiblePosts = getVisiblePosts();
    const totalPages = Math.ceil(visiblePosts.length / postsPerPage);
    
    if (totalPages <= 1) {
      pagination.style.display = 'none';
      return;
    }
    
    pagination.style.display = 'flex';
    
    visiblePosts.forEach((card, index) => {
      const page = Math.floor(index / postsPerPage) + 1;
      card.style.display = page === currentPage ? 'block' : 'none';
    });

    // Update page numbers
    pageNumbers.innerHTML = '';
    
    // Always show first page
    addPageNumber(1);
    
    // Add dots and surrounding pages
    if (totalPages > 7) {
      if (currentPage > 3) {
        const dots = document.createElement('span');
        dots.className = 'page-dots';
        dots.textContent = '...';
        pageNumbers.appendChild(dots);
      }
      
      const startPage = Math.max(2, currentPage - 1);
      const endPage = Math.min(totalPages - 1, currentPage + 1);
      
      for (let i = startPage; i <= endPage; i++) {
        addPageNumber(i);
      }
      
      if (currentPage < totalPages - 2) {
        const dots = document.createElement('span');
        dots.className = 'page-dots';
        dots.textContent = '...';
        pageNumbers.appendChild(dots);
      }
    } else {
      for (let i = 2; i <= totalPages; i++) {
        addPageNumber(i);
      }
    }
    
    // Always show last page if more than 1 page
    if (totalPages > 1) {
      addPageNumber(totalPages);
    }

    // Update buttons
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;
  }

  function addPageNumber(num) {
    const btn = document.createElement('button');
    btn.className = `page-number ${num === currentPage ? 'active' : ''}`;
    btn.textContent = num;
    btn.addEventListener('click', () => {
      currentPage = num;
      updatePagination();
    });
    pageNumbers.appendChild(btn);
  }

  function highlightMatch(text, term) {
    if (!term) return text;
    const regex = new RegExp(`(${term})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }

  function filterPosts() {
    let visibleCount = 0;
    currentPage = 1;

    // Filter featured post
    if (featuredPost) {
      const featuredCategory = featuredPost.dataset.category;
      const featuredTitleEl = featuredPost.querySelector('h2');
      const featuredExcerptEl = featuredPost.querySelector('.featured-content p');
      const featuredTitle = featuredTitleEl?.textContent.toLowerCase() || '';
      const featuredExcerpt = featuredExcerptEl?.textContent.toLowerCase() || '';
      
      const matchesFeaturedCategory = activeCategory === 'All' || featuredCategory === activeCategory;
      const matchesFeaturedTag = !activeTag || featuredTitle.includes(activeTag.toLowerCase()) || featuredExcerpt.includes(activeTag.toLowerCase());
      const matchesFeaturedSearch = !searchTerm || featuredTitle.includes(searchTerm) || featuredExcerpt.includes(searchTerm);
      
      if (matchesFeaturedCategory && matchesFeaturedTag && matchesFeaturedSearch) {
        featuredPost.style.display = 'grid';
        
        // Highlight search term
        if (searchTerm && featuredTitleEl) {
          featuredTitleEl.innerHTML = highlightMatch(featuredTitleEl.textContent, searchTerm);
        }
        if (searchTerm && featuredExcerptEl) {
          featuredExcerptEl.innerHTML = highlightMatch(featuredExcerptEl.textContent, searchTerm);
        }
      } else {
        featuredPost.style.display = 'none';
      }
    }

    postCards.forEach(card => {
      const category = card.dataset.category;
      const titleEl = card.querySelector('h3');
      const excerptEl = card.querySelector('p');
      const title = titleEl?.textContent.toLowerCase() || '';
      const excerpt = excerptEl?.textContent.toLowerCase() || '';
      
      const matchesCategory = activeCategory === 'All' || category === activeCategory;
      const matchesTag = !activeTag || title.includes(activeTag.toLowerCase()) || excerpt.includes(activeTag.toLowerCase());
      const matchesSearch = !searchTerm || title.includes(searchTerm) || excerpt.includes(searchTerm);

      if (matchesCategory && matchesTag && matchesSearch) {
        card.classList.remove('hidden');
        visibleCount++;
        
        // Highlight search term
        if (searchTerm && titleEl) {
          titleEl.innerHTML = highlightMatch(titleEl.textContent, searchTerm);
        }
        if (searchTerm && excerptEl) {
          excerptEl.innerHTML = highlightMatch(excerptEl.textContent, searchTerm);
        }
      } else {
        card.classList.add('hidden');
      }
    });

    noResults.style.display = visibleCount === 0 ? 'block' : 'none';
    updatePagination();
  }

  categoryBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      categoryBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeCategory = btn.dataset.category;
      filterPosts();
    });
  });

  tagBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      btn.classList.toggle('active');
      activeTag = btn.classList.contains('active') ? btn.dataset.tag : '';
      filterPosts();
    });
  });

  searchInput?.addEventListener('input', (e) => {
    searchTerm = e.target.value.toLowerCase();
    filterPosts();
  });

  prevBtn?.addEventListener('click', () => {
    if (currentPage > 1) {
      currentPage--;
      updatePagination();
    }
  });

  nextBtn?.addEventListener('click', () => {
    const visiblePosts = getVisiblePosts();
    const totalPages = Math.ceil(visiblePosts.length / postsPerPage);
    if (currentPage < totalPages) {
      currentPage++;
      updatePagination();
    }
  });

  // Newsletter form
  const sidebarNewsletter = document.getElementById('sidebarNewsletter');
  sidebarNewsletter?.addEventListener('submit', (e) => {
    e.preventDefault();
    alert('Thanks for subscribing!');
    (e.target as HTMLFormElement).reset();
  });

  // Initialize pagination
  updatePagination();
</script>
